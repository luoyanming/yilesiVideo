/**
 * @author luoym
 * @email 13575458746@163.com
 * @descrip 
 * @version v1.0.0
 */
$(function(){var t="";({init:function(){t=this,t.pickerInit(),t.handleClickBind()},pickerInit:function(){var e,n=$("#picker"),a=[],r=[],i=[],s="2000",l="01";n.val(s+" "+l+" 01");for(var o=0;o<41;o++)a[o]=(1980+o).toString();r=t.monthUI(),i=t.dateUI(s,l),n.picker({toolbarTemplate:'<header class="bar bar-nav">                    <button class="button button-link pull-left cancle-picker">取消</button>                    <button class="button button-link pull-right ensure-picker">完成</button>                    </header>',cols:[{textAlign:"center",values:a},{textAlign:"center",values:r},{textAlign:"center",values:i}],onChange:function(n,a,r){var i=n.cols[0].value,o=n.cols[1].value;if(i!=s)return clearTimeout(e),void(e=setTimeout(function(){var e=t.dateUI(i,o);n.cols[2].replaceValues(e),s=i,l=o,n.updateValue()},200));if(o!=l){var c=t.dateUI(i,o);n.cols[2].replaceValues(c),l=o,n.updateValue()}}})},handleClickBind:function(){$(document).on("click",".ensure-picker, .cancle-picker, .button-submit",function(e){var n=$(this);if(n.hasClass("ensure-picker")){var a=$("#picker").val();dateArr=a.split(" "),$("#birthday").val(dateArr[0]+"-"+dateArr[1]+"-"+dateArr[2]),$("#picker").picker("close")}else if(n.hasClass("cancle-picker"))$("#picker").picker("close");else if(n.hasClass("button-submit")){if(n.hasClass("disable"))return!1;var r=$("#number"),i=$("#birthday"),s=r.val(),l=i.val();if(!s)return t.showMsg("请输入您孩子的教学卡卡号"),!1;if(!l)return t.showMsg("请选择您孩子的生日"),!1;n.html("正在绑定...").addClass("disable");var o=l.split("-");$.ajax({url:CONFIG.api+"/parent/ajax/doBind",dataType:"json",type:"post",data:{code:s,birthday:o[0]+o[1]+o[2]},success:function(e){n.html("确定").removeClass("disable"),0==e.code?location.href="./bindsucc.html?studentId="+e.data.studentId:1001==e.code?location.href=CONFIG.redirect_url:t.showMsg(e.errorInfo)},error:function(){n.html("确定").removeClass("disable"),t.showMsg("网络连接异常！请重试!")}})}})},showMsg:function(t){var e=$(".msg-mask"),n=e.find(".text"),a=e.find(".button-ensure");n.html(t),e.fadeIn(300),a.unbind("click"),a.on("click",function(){e.fadeOut(200)})},monthUI:function(){for(var t=[],e=0;e<12;e++)t[e]=e<9?"0"+(e+1):(e+1).toString();return t},dateUI:function(e,n){for(var a=t.getCountDays(new Date(e+"/"+n+"/01")),r=[],i=0;i<a;i++)r[i]=i<9?"0"+(i+1):(i+1).toString();return r},getCountDays:function(t){var e=new Date(t),n=e.getMonth();return e.setMonth(n+1),e.setDate(0),e.getDate()}}).init()});