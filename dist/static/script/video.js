/**
 * @author luoym
 * @email 13575458746@163.com
 * @descrip 
 * @version v1.0.0
 */
$(function(){var t,a=$(".calendar-header"),e=a.find(".date"),s=a.find(".button-prev"),i=a.find(".button-next"),n=$(".calendar-body"),c=n.find(".calendar-date"),d=$(".video-list");({init:function(){t=this,t.time=new Date,t.selectTime=new Date,t.handleBind()},calendarInit:function(a){t.setTitle(a),t.setDate(a)},setTitle:function(a){var s=t.getDate(a);e.html(s.cy+"年"+s.cm+"月"),t.checkLimit(a)},setDate:function(a){var e=t.getCountDays(a),s=t.getDate(a);tmp="",c.html('<div class="loading">正在加载日期...</div>'),$.ajax({url:CONFIG.api+"/parent/ajax/courseRecord/validDate",dataType:"json",type:"post",data:{studentId:t.getQueryString("studentId"),searchDate:s.cy+"-"+s.cm},success:function(s){if(0==s.code){a.setDate(1);for(var i=0;i<a.getDay();i++)tmp+='<p class="date-item"><span class="disable"></span></p>';var n=t.getDate(a),d=t.getDate(t.selectTime);if(s.data.list){for(var l=[],r=0;r<s.data.list.length;r++){var o=s.data.list[r].split("-");l.push(o[2])}for(var m=0;m<e;m++)d.cd==m+1&&n.cy==d.cy&&n.cm==d.cm?tmp+='<p class="date-item"><span class="current" data-date="'+n.cy+"-"+n.cm+"-"+(m+1)+'">'+(m+1)+"</span></p>":l.indexOf(m+1)>-1?tmp+='<p class="date-item"><span data-date="'+n.cy+"-"+n.cm+"-"+(m+1)+'">'+(m+1)+"</span></p>":tmp+='<p class="date-item"><span data-date="'+n.cy+"-"+n.cm+"-"+(m+1)+'" class="disable">'+(m+1)+"</span></p>"}else for(var m=0;m<e;m++)d.cd==m+1&&n.cy==d.cy&&n.cm==d.cm?tmp+='<p class="date-item"><span class="current" data-date="'+n.cy+"-"+n.cm+"-"+(m+1)+'">'+(m+1)+"</span></p>":tmp+='<p class="date-item"><span data-date="'+n.cy+"-"+n.cm+"-"+(m+1)+'">'+(m+1)+"</span></p>";c.html(tmp),t.handleBind()}else 1001==s.code?location.href=CONFIG.redirect_url:c.html('<div class="loading">'+s.errorInfo+"</div>")},error:function(){c.html('<div class="loading">日期加载失败</div>')}})},handleBind:function(){s.unbind("click"),s.on("click",function(){if(s.hasClass("disable"))return!1;var a=t.time,e=t.getDate(a);a.setMonth(e.cm-2),t.time=a,t.calendarInit(t.time)}),i.unbind("click"),i.on("click",function(){if($(this).hasClass("disable"))return!1;var a=t.time,e=t.getDate(a);a.setMonth(e.cm),t.time=a,t.calendarInit(t.time)});var a=c.find("span");a.unbind("click"),a.on("click",function(){if($(this).hasClass("disable"))return!1;a.removeClass("current"),$(this).addClass("current"),t.selectTime=new Date($(this).attr("data-date")),t.getVideoList($(this).attr("data-date"))})},getVideoList:function(a){var e=a.split("-"),s=e[0],i=e[1],n=e[2],c="";i<10&&(i="0"+i),n<10&&(n="0"+n),c=s+"-"+i+"-"+n,d.html('<div class="loading">正在努力加载...</div>'),$.ajax({url:CONFIG.api+"/parent/ajax/courseRecord/list",dataType:"json",type:"post",data:{studentId:t.getQueryString("studentId"),searchDate:c},success:function(t){if(0==t.code){if(!t.data.list)return d.html('<div class="nodata">目前没有课程记录！</div>'),!1;for(var a=t.data.list,e="",s=0;s<a.length;s++)e+='<article class="list-item">',e+='<a href="./player.html?path='+a[s].videoPath+"&thumb="+a[s].thumbnailUrl+'" class="flex-h">',e+='<div class="thumb">',e+='<img src="'+a[s].thumbnailUrl+'">',e+="</div>",e+='<div class="info flex-a-i">',e+='<p class="name">'+a[s].courseName+"</p>",e+='<p class="desc">',e+='<span class="time">'+a[s].videoLength+"</span>",e+='<span class="class">'+a[s].className+"</span>",e+="</p>",e+="</div>",e+='<div class="arrow"></div>',e+="</a>",e+="</article>";d.html(e)}else 1001==t.code?location.href=CONFIG.redirect_url:d.html('<div class="loading">'+t.errorInfo+"</div>")},error:function(){d.html('<div class="loading">数据加载失败</div>')}})},checkLimit:function(a){var e=t.getDate(a),n=t.getDate(new Date);s.removeClass("disable"),i.removeClass("disable"),2017==e.cy&&1==e.cm?s.addClass("disable"):e.cy==n.cy&&e.cm==n.cm&&i.addClass("disable")},getDate:function(t){var a=new Date(t);return{cy:a.getFullYear(),cm:a.getMonth()+1,cd:a.getDate()}},getCountDays:function(t){var a=new Date(t),e=a.getMonth();return a.setMonth(e+1),a.setDate(0),a.getDate()},getQueryString:function(t){var a=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),e=window.location.search.substr(1).match(a);return null!=e?unescape(e[2]):null}}).init()});