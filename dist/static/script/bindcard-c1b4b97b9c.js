/**
 * @author luoym
 * @email 13575458746@163.com
 * @descrip 
 * @version v1.0.0
 */
$(function(){var e="";({init:function(){e=this,e.pickerInit(),e.handleClickBind()},pickerInit:function(){var t,n=$("#picker"),a=[],r=[],i=[],s="2000",o="01";n.val(s+" "+o+" 01");for(var c=0;c<41;c++)a[c]=(1980+c).toString();r=e.monthUI(),i=e.dateUI(s,o),n.picker({toolbarTemplate:'<header class="bar bar-nav">                    <button class="button button-link pull-left cancle-picker">取消</button>                    <button class="button button-link pull-right ensure-picker">完成</button>                    </header>',cols:[{textAlign:"center",values:a},{textAlign:"center",values:r},{textAlign:"center",values:i}],onChange:function(n,a,r){var i=n.cols[0].value,c=n.cols[1].value;if(i!=s)return clearTimeout(t),void(t=setTimeout(function(){var t=e.dateUI(i,c);n.cols[2].replaceValues(t),s=i,o=c,n.updateValue()},200));if(c!=o){var l=e.dateUI(i,c);n.cols[2].replaceValues(l),o=c,n.updateValue()}}})},handleClickBind:function(){$(document).on("click",".ensure-picker, .cancle-picker, .button-submit",function(t){var n=$(this);if(n.hasClass("ensure-picker")){var a=$("#picker").val();dateArr=a.split(" "),$("#birthday").val(dateArr[0]+"-"+dateArr[1]+"-"+dateArr[2]),$("#picker").picker("close")}else if(n.hasClass("cancle-picker"))$("#picker").picker("close");else if(n.hasClass("button-submit")){if(n.hasClass("disable"))return!1;var r=$("#number"),i=$("#birthday"),s=r.val(),o=i.val();if(!s)return e.showMsg("请输入您孩子的教学卡卡号"),!1;if(!o)return e.showMsg("请选择您孩子的生日"),!1;n.html("正在绑定...").addClass("disable");var c=o.split("-");$.ajax({url:CONFIG.api+"/parent/ajax/doBind",dataType:"json",type:"post",data:{code:s,birthday:c[0]+c[1]+c[2]},success:function(t){n.html("确定").removeClass("disable"),0==t.code?location.href="./bindsucc.html?studentId="+t.data.studentId+"&studentName="+encodeURI(encodeURIComponent(t.data.studentName))+"&code="+s+"&birthDay="+c[0]+c[1]+c[2]:1001==t.code?location.href=CONFIG.bind_redirect_url:e.showMsg(t.errorInfo)},error:function(){n.html("确定").removeClass("disable"),e.showMsg("网络连接异常！请重试!")}})}})},showMsg:function(e){var t=$(".msg-mask"),n=t.find(".text"),a=t.find(".button-ensure");n.html(e),t.fadeIn(300),a.unbind("click"),a.on("click",function(){t.fadeOut(200)})},monthUI:function(){for(var e=[],t=0;t<12;t++)e[t]=t<9?"0"+(t+1):(t+1).toString();return e},dateUI:function(t,n){for(var a=e.getCountDays(new Date(t+"/"+n+"/01")),r=[],i=0;i<a;i++)r[i]=i<9?"0"+(i+1):(i+1).toString();return r},getCountDays:function(e){var t=new Date(e),n=t.getMonth();return t.setMonth(n+1),t.setDate(0),t.getDate()}}).init()});