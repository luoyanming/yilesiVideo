/**
 * @author luoym
 * @email 13575458746@163.com
 * @descrip 
 * @version v1.0.0
 */
$(function(){var t,a=$(".calendar-header"),e=a.find(".date"),s=a.find(".button-prev"),i=a.find(".button-next"),c=$(".calendar-body"),n=c.find(".calendar-date"),d=$(".video-list");({init:function(){t=this,t.time=new Date,t.selectTime=new Date,t.calendarInit(t.time);var a=t.getDate(new Date);t.getVideoList(a.cy+"-"+a.cm+"-"+a.cd)},resetTitle:function(){$("body")},calendarInit:function(a){t.setTitle(a),t.setDate(a)},setTitle:function(a){var s=t.getDate(a);e.html(s.cy+"年"+s.cm+"月"),t.checkLimit(a)},setDate:function(a){var e=t.getCountDays(a),s=t.getDate(a);tmp="",n.html('<div class="loading">正在加载日期...</div>'),$.ajax({url:CONFIG.api+"/parent/ajax/courseRecord/validDate/by/macNo",dataType:"json",type:"post",data:{macNo:t.getQueryString("macNo"),searchDate:s.cy+"-"+s.cm},success:function(s){if(0==s.code){a.setDate(1);for(var i=0;i<a.getDay();i++)tmp+='<p class="date-item"><span class="disable"></span></p>';var c=t.getDate(a),d=t.getDate(t.selectTime);if(s.data.list){for(var l=[],r=0;r<s.data.list.length;r++){var o=s.data.list[r].split("-");l.push(o[2])}for(var m=0;m<e;m++)d.cd==m+1&&c.cy==d.cy&&c.cm==d.cm?tmp+='<p class="date-item"><span class="current" data-date="'+c.cy+"-"+c.cm+"-"+(m+1)+'">'+(m+1)+"</span></p>":l.indexOf((m+1).toString())>-1?tmp+='<p class="date-item"><span data-date="'+c.cy+"-"+c.cm+"-"+(m+1)+'">'+(m+1)+"</span></p>":tmp+='<p class="date-item"><span data-date="'+c.cy+"-"+c.cm+"-"+(m+1)+'" class="disable">'+(m+1)+"</span></p>"}else for(var m=0;m<e;m++)d.cd==m+1&&c.cy==d.cy&&c.cm==d.cm?tmp+='<p class="date-item"><span class="current" data-date="'+c.cy+"-"+c.cm+"-"+(m+1)+'">'+(m+1)+"</span></p>":tmp+='<p class="date-item"><span data-date="'+c.cy+"-"+c.cm+"-"+(m+1)+'">'+(m+1)+"</span></p>";n.html(tmp),t.handleBind()}else 1001==s.code||n.html('<div class="loading">'+s.errorInfo+"</div>")},error:function(){n.html('<div class="loading">日期加载失败</div>')}})},handleBind:function(){s.unbind("click"),s.on("click",function(){if(s.hasClass("disable"))return!1;var a=t.time,e=t.getDate(a);a.setMonth(e.cm-2),t.time=a,t.calendarInit(t.time)}),i.unbind("click"),i.on("click",function(){if($(this).hasClass("disable"))return!1;var a=t.time,e=t.getDate(a);a.setMonth(e.cm),t.time=a,t.calendarInit(t.time)});var a=n.find("span");a.unbind("click"),a.on("click",function(){if($(this).hasClass("disable"))return!1;a.removeClass("current"),$(this).addClass("current"),t.selectTime=new Date($(this).attr("data-date")),t.getVideoList($(this).attr("data-date"))})},getVideoList:function(a){var e=a.split("-"),s=e[0],i=e[1],c=e[2],n="";i<10&&(i="0"+i),c<10&&(c="0"+c),n=s+"-"+i+"-"+c,d.html('<div class="loading">正在努力加载...</div>'),$.ajax({url:CONFIG.api+"/parent/ajax/courseRecord/list/by/macNo",dataType:"json",type:"post",data:{macNo:t.getQueryString("macNo"),searchDate:n},success:function(a){if(0==a.code){if(a.data.showClock)return d.html('<div class="timeclock">今日课程将在18:00准时放送！</div>'),!1;if(0==a.data.list.length)return d.html('<div class="nodata">目前没有课程记录！</div>'),!1;for(var e=a.data.list,s="",i=0;i<e.length;i++)s+='<article class="list-item">',s+='<a href="./listdetail.html?macNo='+t.getQueryString("macNo")+"&recordId="+e[i].recordId+'" class="flex-h">',s+='<div class="thumb">',s+='<img src="'+e[i].thumbnailUrl+'">',s+="</div>",s+='<div class="info flex-a-i">',s+='<p class="name">'+e[i].courseName+"</p>",s+='<p class="desc">',s+='<span class="class">'+e[i].teacherName+"</span>",s+="</p>",s+="</div>",s+='<div class="arrow"></div>',s+="</a>",s+="</article>";d.html(s)}else 1001==a.code||d.html('<div class="loading">'+a.errorInfo+"</div>")},error:function(){d.html('<div class="loading">数据加载失败</div>')}})},checkLimit:function(a){var e=t.getDate(a),c=t.getDate(new Date);s.removeClass("disable"),i.removeClass("disable"),2017==e.cy&&1==e.cm?s.addClass("disable"):e.cy==c.cy&&e.cm==c.cm&&i.addClass("disable")},getDate:function(t){var a=new Date(t);return{cy:a.getFullYear(),cm:a.getMonth()+1,cd:a.getDate()}},getCountDays:function(t){var a=new Date(t),e=a.getMonth();return a.setMonth(e+1),a.setDate(0),a.getDate()},getQueryString:function(t){var a=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),e=window.location.search.substr(1).match(a);return null!=e?unescape(e[2]):null}}).init()});