/**
 * @author luoym
 * @email 13575458746@163.com
 * @descrip 
 * @version v1.0.0
 */
$(function(){var e="";({init:function(){e=this,e.getquery(),e.handleClickBind()},getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},getquery:function(){var t=decodeURI(decodeURIComponent(e.getQueryString("studentName"))),n=e.getQueryString("code"),a=e.getQueryString("birthDay");console.log(t,n,a),$("#name").val(t),$("#code").val(n),e.pickerInit(a)},pickerInit:function(t){var n,a=$("#picker"),r=[],i=[],o=[],s="2000",l="01";if(t){var t=t.toString(),c=t.substring(0,4),u=t.substring(4,6),d=t.substring(6,8);a.val(c+" "+u+" "+d),$("#birthday").val(c+"-"+u+"-"+d)}else a.val(s+" "+l+" 01");for(var f=0;f<41;f++)r[f]=(1980+f).toString();i=e.monthUI(),o=e.dateUI(s,l),a.picker({toolbarTemplate:'<header class="bar bar-nav">                    <button class="button button-link pull-left cancle-picker">取消</button>                    <button class="button button-link pull-right ensure-picker">完成</button>                    </header>',cols:[{textAlign:"center",values:r},{textAlign:"center",values:i},{textAlign:"center",values:o}],onChange:function(t,a,r){var i=t.cols[0].value,o=t.cols[1].value;if(i!=s)return clearTimeout(n),void(n=setTimeout(function(){var n=e.dateUI(i,o);t.cols[2].replaceValues(n),s=i,l=o,t.updateValue()},200));if(o!=l){var c=e.dateUI(i,o);t.cols[2].replaceValues(c),l=o,t.updateValue()}}})},handleClickBind:function(){$(document).on("click",".ensure-picker, .cancle-picker, .button-submit",function(t){var n=$(this);if(n.hasClass("ensure-picker")){var a=$("#picker").val();dateArr=a.split(" "),$("#birthday").val(dateArr[0]+"-"+dateArr[1]+"-"+dateArr[2]),$("#picker").picker("close")}else if(n.hasClass("cancle-picker"))$("#picker").picker("close");else if(n.hasClass("button-submit")){if(n.hasClass("disable"))return!1;var r=$("#birthday"),i=r.val();if(!i)return e.showMsg("请选择持卡人生日"),!1;n.html("正在保存...").addClass("disable");var o=i.split("-");$.ajax({url:CONFIG.api+"/parent/ajax/update/cardInfo",dataType:"json",type:"post",data:{code:$("#code").val(),birthday:o[0]+o[1]+o[2]},success:function(t){n.html("保存").removeClass("disable"),0==t.code?e.showMsg("保存成功!"):1001==t.code?location.href=CONFIG.bind_redirect_url:e.showMsg(t.errorInfo)},error:function(){n.html("保存").removeClass("disable"),e.showMsg("网络连接异常！请重试!")}})}})},showMsg:function(e){var t=$(".msg-mask"),n=t.find(".text"),a=t.find(".button-ensure");n.html(e),t.fadeIn(300),a.unbind("click"),a.on("click",function(){t.fadeOut(200),location.href="./cardlist.html"})},monthUI:function(){for(var e=[],t=0;t<12;t++)e[t]=t<9?"0"+(t+1):(t+1).toString();return e},dateUI:function(t,n){for(var a=e.getCountDays(new Date(t+"/"+n+"/01")),r=[],i=0;i<a;i++)r[i]=i<9?"0"+(i+1):(i+1).toString();return r},getCountDays:function(e){var t=new Date(e),n=t.getMonth();return t.setMonth(n+1),t.setDate(0),t.getDate()}}).init()});